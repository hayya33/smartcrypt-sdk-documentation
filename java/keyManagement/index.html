<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Smartcrypt SDK for Java"><meta name=author content="PKWARE, Inc."><link href=https://sdk.smartcrypt.com/java/keyManagement/ rel=canonical><link rel=icon href=../images/smartcrypt.svg><meta name=generator content="mkdocs-1.4.0, mkdocs-material-8.5.6"><title>Overview - Smartcrypt Java SDK</title><link rel=stylesheet href=../assets/stylesheets/main.20d9efc8.min.css><link rel=stylesheet href=../assets/stylesheets/palette.cbb835fc.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../css/app.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme data-md-color-primary=none data-md-color-accent=none> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#key-management class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="Smartcrypt Java SDK" class="md-header__button md-logo" aria-label="Smartcrypt Java SDK" data-md-component=logo> <img src=../images/smartcrypt.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Smartcrypt Java SDK </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Overview </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/pkware/smartcrypt-sdk-documentation/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class=md-tabs__link> Overview </a> </li> <li class=md-tabs__item> <a href=../concepts/logging/ class=md-tabs__link> General concepts </a> </li> <li class=md-tabs__item> <a href=../faq/ class=md-tabs__link> FAQ </a> </li> <li class=md-tabs__item> <a href=../troubleshooting/ class=md-tabs__link> Troubleshooting </a> </li> <li class=md-tabs__item> <a href=../fileEncryption/ class=md-tabs__link> File encryption </a> </li> <li class=md-tabs__item> <a href=./ class="md-tabs__link md-tabs__link--active"> Key management </a> </li> <li class=md-tabs__item> <a href=../changelog/ class=md-tabs__link> Change log </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="Smartcrypt Java SDK" class="md-nav__button md-logo" aria-label="Smartcrypt Java SDK" data-md-component=logo> <img src=../images/smartcrypt.svg alt=logo> </a> Smartcrypt Java SDK </label> <div class=md-nav__source> <a href=https://github.com/pkware/smartcrypt-sdk-documentation/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> Overview </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> General concepts <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="General concepts" data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> General concepts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../concepts/logging/ class=md-nav__link> Logging </a> </li> <li class=md-nav__item> <a href=../concepts/flpe/ class=md-nav__link> Format and length preserving encryption </a> </li> <li class=md-nav__item> <a href=../concepts/notifications/ class=md-nav__link> Notifications </a> </li> <li class=md-nav__item> <a href=../concepts/observables/ class=md-nav__link> Observables </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../faq/ class=md-nav__link> FAQ </a> </li> <li class=md-nav__item> <a href=../troubleshooting/ class=md-nav__link> Troubleshooting </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> File encryption <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="File encryption" data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> File encryption </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../fileEncryption/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../fileEncryption/installing/ class=md-nav__link> Installing </a> </li> <li class=md-nav__item> <a href=../fileEncryption/zipDetails/ class=md-nav__link> Zip file details </a> </li> <li class=md-nav__item> <a href=../api/index.html?com/pkware/smartcrypt/unstructured/package-summary.html class=md-nav__link> API docs </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6 checked> <label class=md-nav__link for=__nav_6> Key management <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Key management" data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Key management </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Overview <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Overview </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#setup class=md-nav__link> Setup </a> <nav class=md-nav aria-label=Setup> <ul class=md-nav__list> <li class=md-nav__item> <a href=#lifecycle class=md-nav__link> Lifecycle </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#login class=md-nav__link> Login </a> <nav class=md-nav aria-label=Login> <ul class=md-nav__list> <li class=md-nav__item> <a href=#login-managed-account class=md-nav__link> Login managed account </a> <nav class=md-nav aria-label="Login managed account"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#single-sign-on class=md-nav__link> Single sign-on </a> <nav class=md-nav aria-label="Single sign-on"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#advantages-of-implicit-login class=md-nav__link> Advantages of Implicit Login </a> </li> <li class=md-nav__item> <a href=#how-it-works class=md-nav__link> How it works </a> </li> <li class=md-nav__item> <a href=#configuring-the-jvm class=md-nav__link> Configuring the JVM </a> </li> <li class=md-nav__item> <a href=#diagnosing-jvm-problems class=md-nav__link> Diagnosing JVM problems </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#create-smartkey class=md-nav__link> Create Smartkey </a> </li> <li class=md-nav__item> <a href=#update-smartkey class=md-nav__link> Update Smartkey </a> </li> <li class=md-nav__item> <a href=#working-offline class=md-nav__link> Working offline </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=installing/ class=md-nav__link> Installing </a> </li> <li class=md-nav__item> <a href=keySegregation/ class=md-nav__link> Key segregation </a> </li> <li class=md-nav__item> <a href=metaClient/ class=md-nav__link> MetaClient </a> </li> <li class=md-nav__item> <a href=../api/index.html?com/pkware/smartcrypt/keymanagement/package-summary.html class=md-nav__link> API docs </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../changelog/ class=md-nav__link> Change log </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#setup class=md-nav__link> Setup </a> <nav class=md-nav aria-label=Setup> <ul class=md-nav__list> <li class=md-nav__item> <a href=#lifecycle class=md-nav__link> Lifecycle </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#login class=md-nav__link> Login </a> <nav class=md-nav aria-label=Login> <ul class=md-nav__list> <li class=md-nav__item> <a href=#login-managed-account class=md-nav__link> Login managed account </a> <nav class=md-nav aria-label="Login managed account"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#single-sign-on class=md-nav__link> Single sign-on </a> <nav class=md-nav aria-label="Single sign-on"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#advantages-of-implicit-login class=md-nav__link> Advantages of Implicit Login </a> </li> <li class=md-nav__item> <a href=#how-it-works class=md-nav__link> How it works </a> </li> <li class=md-nav__item> <a href=#configuring-the-jvm class=md-nav__link> Configuring the JVM </a> </li> <li class=md-nav__item> <a href=#diagnosing-jvm-problems class=md-nav__link> Diagnosing JVM problems </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#create-smartkey class=md-nav__link> Create Smartkey </a> </li> <li class=md-nav__item> <a href=#update-smartkey class=md-nav__link> Update Smartkey </a> </li> <li class=md-nav__item> <a href=#working-offline class=md-nav__link> Working offline </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/pkware/smartcrypt-sdk-documentation/edit/main/java/keyManagement/index.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> </a> <h1 id=key-management>Key management<a class=headerlink href=#key-management title="Permanent link">&para;</a></h1> <p>The key management component allows for querying, modifying, and creating Smartkeys.</p> <h2 id=setup>Setup<a class=headerlink href=#setup title="Permanent link">&para;</a></h2> <div class="tabbed-set tabbed-alternate" data-tabs=1:2><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><input id=__tabbed_1_2 name=__tabbed_1 type=radio><div class=tabbed-labels><label for=__tabbed_1_1>Java</label><label for=__tabbed_1_2>Kotlin</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=kn>import</span><span class=w> </span><span class=nn>com.pkware.smartcrypt.keymanagement.SmartcryptKeyManagement</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>com.pkware.smartcrypt.keymanagement.SmartcryptKeyManagementImpl</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>com.pkware.smartcrypt.metaclient.MetaClient</span><span class=p>;</span><span class=w></span>

<span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>SmartcryptKeyManagement</span><span class=w> </span><span class=nf>setup</span><span class=p>(</span><span class=n>MetaClient</span><span class=w> </span><span class=n>metaClient</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>SmartcryptKeyManagementImpl</span><span class=p>.</span><span class=na>Builder</span><span class=p>()</span><span class=w></span>
<span class=w>            </span><span class=p>.</span><span class=na>metaClient</span><span class=p>(</span><span class=n>metaClient</span><span class=p>)</span><span class=w></span>
<span class=hll><span class=w>            </span><span class=c1>// TODO Optionally provide a PersistenceCallback, if you want the SDK to work while offline. You need to implement this class yourself.</span><span class=w></span>
</span><span class=w>            </span><span class=p>.</span><span class=na>persistenceCallback</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>FileSystemPersistenceCallback</span><span class=p>())</span><span class=w></span>
<span class=w>            </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=nn>com.pkware.smartcrypt.keymanagement.SmartcryptKeyManagement</span><span class=w></span>
<span class=k>import</span><span class=w> </span><span class=nn>com.pkware.smartcrypt.keymanagement.SmartcryptKeyManagementImpl</span><span class=w></span>
<span class=k>import</span><span class=w> </span><span class=nn>com.pkware.smartcrypt.metaclient.MetaClient</span><span class=w></span>

<span class=kd>fun</span><span class=w> </span><span class=n>MetaClient</span><span class=p>.</span><span class=nf>newSmartcryptKeyManagement</span><span class=p>():</span><span class=w> </span><span class=n>SmartcryptKeyManagement</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>SmartcryptKeyManagementImpl</span><span class=p>.</span><span class=na>Builder</span><span class=p>()</span><span class=w></span>
<span class=w>    </span><span class=p>.</span><span class=na>metaClient</span><span class=p>(</span><span class=k>this</span><span class=p>)</span><span class=w></span>
<span class=w>    </span><span class=c1>// TODO Optionally provide a PersistenceCallback, if you want the SDK to work while offline. You need to implement this class yourself.</span><span class=w></span>
<span class=hll><span class=w>    </span><span class=p>.</span><span class=na>persistenceCallback</span><span class=p>(</span><span class=n>new</span><span class=w> </span><span class=n>FileSystemPersistenceCallback</span><span class=p>())</span><span class=w></span>
</span><span class=w>    </span><span class=p>.</span><span class=na>build</span><span class=p>()</span><span class=w></span>
</code></pre></div> </div> </div> </div> <h3 id=lifecycle>Lifecycle<a class=headerlink href=#lifecycle title="Permanent link">&para;</a></h3> <p>A single instance of <code>SmartcryptKeyManagement</code> should generally be treated as a singleton by your application. You typically want all operations to use that one instance. Using multiple instances will not cause problems, but will consume a lot more system resources, as more threads and background processes will get used.</p> <h2 id=login>Login<a class=headerlink href=#login title="Permanent link">&para;</a></h2> <p>There are two types of accounts in Smartcrypt: Managed and Unmanaged. A Managed account is one that is tied to an identity system like Active Directory. An Unmanaged account exists only in the PKWARE Enterprise Manager.</p> <p>For the most part, the two account types work the same way, but during login, different calls have to be made based on the type of the account. Unmanaged accounts need to log in with [loginUnManagedAccount], while Managed accounts can choose between a regular login using a username/password combo, and a single sign-on style login, using Kerberos or Integrated Windows Authentication (IWA).</p> <div class="admonition example"> <p class=admonition-title>Login unmanaged account</p> <div class="tabbed-set tabbed-alternate" data-tabs=2:2><input checked=checked id=__tabbed_2_1 name=__tabbed_2 type=radio><input id=__tabbed_2_2 name=__tabbed_2 type=radio><div class=tabbed-labels><label for=__tabbed_2_1>Java</label><label for=__tabbed_2_2>Kotlin</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=kn>import</span><span class=w> </span><span class=nn>com.pkware.smartcrypt.keymanagement.AccountManagement</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>com.pkware.smartcrypt.keymanagement.SmartcryptKeyManagement</span><span class=p>;</span><span class=w></span>

<span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>loginUnmanaged</span><span class=p>(</span><span class=n>SmartcryptKeyManagement</span><span class=w> </span><span class=n>keyManagement</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>emailAddress</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>password</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>AccountManagement</span><span class=w> </span><span class=n>accountManagement</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>keyManagement</span><span class=p>.</span><span class=na>getAccountManagement</span><span class=p>();</span><span class=w></span>
<span class=w>    </span><span class=n>accountManagement</span><span class=p>.</span><span class=na>loginUnManagedAccount</span><span class=p>(</span><span class=n>emailAddress</span><span class=p>,</span><span class=w> </span><span class=n>password</span><span class=p>);</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=nn>com.pkware.smartcrypt.keymanagement.SmartcryptKeyManagement</span><span class=w></span>

<span class=kd>fun</span><span class=w> </span><span class=nf>loginUnmanaged</span><span class=p>(</span><span class=n>keyManagement</span><span class=p>:</span><span class=w> </span><span class=n>SmartcryptKeyManagement</span><span class=p>,</span><span class=w> </span><span class=n>emailAddress</span><span class=p>:</span><span class=w> </span><span class=kt>String</span><span class=p>,</span><span class=w> </span><span class=n>password</span><span class=p>:</span><span class=w> </span><span class=kt>String</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=kd>val</span><span class=w> </span><span class=nv>accountManagement</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>keyManagement</span><span class=p>.</span><span class=na>getAccountManagement</span><span class=p>()</span><span class=w></span>
<span class=w>    </span><span class=n>accountManagement</span><span class=p>.</span><span class=na>loginUnManagedAccount</span><span class=p>(</span><span class=n>emailAddress</span><span class=p>,</span><span class=w> </span><span class=n>password</span><span class=p>)</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div> </div> </div> </div> </div> <h3 id=login-managed-account>Login managed account<a class=headerlink href=#login-managed-account title="Permanent link">&para;</a></h3> <p>For a managed account, you have to choose between a password-based login and single sign-on. The password based approach is recommended during development as it is significantly easier to set up, but single sign-on typically provides a better deployment process for production scenarios.</p> <div class="admonition example"> <p class=admonition-title>Login managed account with password</p> <div class="tabbed-set tabbed-alternate" data-tabs=3:2><input checked=checked id=__tabbed_3_1 name=__tabbed_3 type=radio><input id=__tabbed_3_2 name=__tabbed_3 type=radio><div class=tabbed-labels><label for=__tabbed_3_1>Java</label><label for=__tabbed_3_2>Kotlin</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=kn>import</span><span class=w> </span><span class=nn>com.pkware.smartcrypt.keymanagement.AccountManagement</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>com.pkware.smartcrypt.keymanagement.SmartcryptKeyManagement</span><span class=p>;</span><span class=w></span>

<span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>loginManaged</span><span class=p>(</span><span class=n>SmartcryptKeyManagement</span><span class=w> </span><span class=n>keyManagement</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>emailAddress</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>password</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>AccountManagement</span><span class=w> </span><span class=n>accountManagement</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>keyManagement</span><span class=p>.</span><span class=na>getAccountManagement</span><span class=p>();</span><span class=w></span>
<span class=w>    </span><span class=n>accountManagement</span><span class=p>.</span><span class=na>loginManagedAccount</span><span class=p>(</span><span class=n>emailAddress</span><span class=p>,</span><span class=w> </span><span class=n>password</span><span class=p>);</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=nn>com.pkware.smartcrypt.keymanagement.SmartcryptKeyManagement</span><span class=w></span>

<span class=kd>fun</span><span class=w> </span><span class=nf>loginManaged</span><span class=p>(</span><span class=n>keyManagement</span><span class=p>:</span><span class=w> </span><span class=n>SmartcryptKeyManagement</span><span class=p>,</span><span class=w> </span><span class=n>emailAddress</span><span class=p>:</span><span class=w> </span><span class=kt>String</span><span class=p>,</span><span class=w> </span><span class=n>password</span><span class=p>:</span><span class=w> </span><span class=kt>String</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=kd>val</span><span class=w> </span><span class=nv>accountManagement</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>keyManagement</span><span class=p>.</span><span class=na>getAccountManagement</span><span class=p>()</span><span class=w></span>
<span class=w>    </span><span class=n>accountManagement</span><span class=p>.</span><span class=na>loginManagedAccount</span><span class=p>(</span><span class=n>emailAddress</span><span class=p>,</span><span class=w> </span><span class=n>password</span><span class=p>)</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div> </div> </div> </div> </div> <h4 id=single-sign-on>Single sign-on<a class=headerlink href=#single-sign-on title="Permanent link">&para;</a></h4> <p>The Smartcrypt SDK supports single sign-on login flows for managed users on Windows and unix through a mechanism called Implicit Login.</p> <div class="admonition example"> <p class=admonition-title>Login managed account with single sign-on</p> <div class="tabbed-set tabbed-alternate" data-tabs=4:2><input checked=checked id=__tabbed_4_1 name=__tabbed_4 type=radio><input id=__tabbed_4_2 name=__tabbed_4 type=radio><div class=tabbed-labels><label for=__tabbed_4_1>Java</label><label for=__tabbed_4_2>Kotlin</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=kn>import</span><span class=w> </span><span class=nn>com.pkware.smartcrypt.keymanagement.AccountManagement</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>com.pkware.smartcrypt.keymanagement.SmartcryptKeyManagement</span><span class=p>;</span><span class=w></span>

<span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>loginSingleSignOn</span><span class=p>(</span><span class=n>SmartcryptKeyManagement</span><span class=w> </span><span class=n>keyManagement</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>AccountManagement</span><span class=w> </span><span class=n>accountManagement</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>keyManagement</span><span class=p>.</span><span class=na>getAccountManagement</span><span class=p>();</span><span class=w></span>
<span class=w>    </span><span class=n>accountManagement</span><span class=p>.</span><span class=na>loginImplicitAccount</span><span class=p>();</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=nn>com.pkware.smartcrypt.keymanagement.SmartcryptKeyManagement</span><span class=w></span>

<span class=kd>fun</span><span class=w> </span><span class=nf>loginSingleSignOn</span><span class=p>(</span><span class=n>keyManagement</span><span class=p>:</span><span class=w> </span><span class=n>SmartcryptKeyManagement</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=kd>val</span><span class=w> </span><span class=nv>accountManagement</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>keyManagement</span><span class=p>.</span><span class=na>getAccountManagement</span><span class=p>()</span><span class=w></span>
<span class=w>    </span><span class=n>accountManagement</span><span class=p>.</span><span class=na>loginImplicitAccount</span><span class=p>()</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div> </div> </div> </div> </div> <h5 id=advantages-of-implicit-login>Advantages of Implicit Login<a class=headerlink href=#advantages-of-implicit-login title="Permanent link">&para;</a></h5> <p>Several features make Implicit Login the recommended authentication mechanism.</p> <p>For back-office applications, Implicit Login provides the convenience of not needing to hard code, manually enter or place the credentials into a configuration file. This improves security and makes it easier to deploy applications.</p> <p>For end-user applications, companies typically want the end user to login with domain credentials when running the application. In this case, Implicit Login affords the ability to skip a login prompt, enabling a seamless user experience. This is particularly desirable when modifying existing business applications to incorporate Smartcrypt data protection.</p> <h5 id=how-it-works>How it works<a class=headerlink href=#how-it-works title="Permanent link">&para;</a></h5> <p>On Windows, Integrated Windows Authentication (IWA) is used. The identity of the Active Directory Domain User who launches the process using the Smartcrypt SDK is used.</p> <p>On MacOS and Linux, the Kerberos system is used to identify and authenticate the user. Domain-joined MacOS installations are automatically configured. On Linux, the <a href=https://web.mit.edu/kerberos/krb5-latest/doc/user/user_commands/kinit.html>kinit</a> program is used. When properly configured, Linux machines will automatically run <code>kinit</code> when users perform a password-based system login.</p> <p>On MacOS and Linux, the JVM must be configured to correctly integrate with the Kerberos system. Which Active Directory Domain User identity is used depends on the configuration.</p> <h5 id=configuring-the-jvm>Configuring the JVM<a class=headerlink href=#configuring-the-jvm title="Permanent link">&para;</a></h5> <p>The simplest way to get started is to set the <code>java.security.krb5.realm</code> and <code>java.security.krb5.kdc</code> system properties:</p> <div class="tabbed-set tabbed-alternate" data-tabs=5:2><input checked=checked id=__tabbed_5_1 name=__tabbed_5 type=radio><input id=__tabbed_5_2 name=__tabbed_5 type=radio><div class=tabbed-labels><label for=__tabbed_5_1>Java</label><label for=__tabbed_5_2>Kotlin</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>setupKerberos</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=c1>// Provide the Kerberos realm that your user is in</span><span class=w></span>
<span class=w>    </span><span class=n>System</span><span class=p>.</span><span class=na>setProperty</span><span class=p>(</span><span class=s>&quot;java.security.krb5.realm&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;EXAMPLE.COM&quot;</span><span class=p>);</span><span class=w></span>
<span class=w>    </span><span class=c1>// Provide the name of a Kerberos ticketing server</span><span class=w></span>
<span class=w>    </span><span class=n>System</span><span class=p>.</span><span class=na>setProperty</span><span class=p>(</span><span class=s>&quot;java.security.krb5.kdc&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;dc01.example.com&quot;</span><span class=p>);</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=kd>fun</span><span class=w> </span><span class=nf>setupKerberos</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=c1>// Provide the Kerberos realm that your user is in</span><span class=w></span>
<span class=w>    </span><span class=n>System</span><span class=p>.</span><span class=na>setProperty</span><span class=p>(</span><span class=s>&quot;java.security.krb5.realm&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;EXAMPLE.COM&quot;</span><span class=p>)</span><span class=w></span>
<span class=w>    </span><span class=c1>// Provide the name of a Kerberos ticketing server</span><span class=w></span>
<span class=w>    </span><span class=n>System</span><span class=p>.</span><span class=na>setProperty</span><span class=p>(</span><span class=s>&quot;java.security.krb5.kdc&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;dc01.example.com&quot;</span><span class=p>)</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div> </div> </div> </div> <p>For a production rollout, you should set the <code>java.security.krb5.conf</code> system property to point at the <code>krb5.conf</code> on the host system. Consult your Kerberos or Windows Domain Administrator for more information on the details of your Kerberos environment.</p> <h5 id=diagnosing-jvm-problems>Diagnosing JVM problems<a class=headerlink href=#diagnosing-jvm-problems title="Permanent link">&para;</a></h5> <p>To start, ensure that you can successfully acquire a Kerberos TGT with the <a href=https://web.mit.edu/kerberos/krb5-latest/doc/user/user_commands/kinit.html>kinit</a> utility. When this is successful, proceed.</p> <p>The Smartcrypt SDK has a built-in diagnostic utility. To activate it</p> <ol> <li>Set the logging level to <code>TRACE</code></li> <li>Run the <code>java</code> command with the flag <code>-Djava.security.debug=net,gssloginconfig,configfile,configparser,logincontext</code> to enable detailed JVM logging</li> <li>Call <a href=../api/com/pkware/smartcrypt/metaclient/MetaClient.html#loginImplicitAccount()>MetaClient#loginImplicitAccount()</a>. This will cause the utility to write diagnostics to the configured <a href=../api/com/pkware/smartcrypt/metaclient/Logger.html>Logger</a>.</li> </ol> <p>The diagnostic utility will inspect your current configuration for common problems. The additional logging may be helpful in determining how the JVM is interpreting the current Kerberos setup.</p> <h2 id=create-smartkey>Create Smartkey<a class=headerlink href=#create-smartkey title="Permanent link">&para;</a></h2> <div class="tabbed-set tabbed-alternate" data-tabs=6:2><input checked=checked id=__tabbed_6_1 name=__tabbed_6 type=radio><input id=__tabbed_6_2 name=__tabbed_6 type=radio><div class=tabbed-labels><label for=__tabbed_6_1>Java</label><label for=__tabbed_6_2>Kotlin</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=kn>import</span><span class=w> </span><span class=nn>com.pkware.smartcrypt.keymanagement.SmartcryptKeyManagement</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>com.pkware.smartcrypt.keymanagement.SmartkeySpec</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>com.pkware.smartcrypt.keymanagement.Smartkeys</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>com.pkware.smartcrypt.keymanagement.smartkeys.Smartkey</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>io.reactivex.Observable</span><span class=p>;</span><span class=w></span>

<span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>createSmartkey</span><span class=p>(</span><span class=n>SmartcryptKeyManagement</span><span class=w> </span><span class=n>keyManagement</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>Smartkeys</span><span class=w> </span><span class=n>smartkeys</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>keyManagement</span><span class=p>.</span><span class=na>getSmartkeys</span><span class=p>();</span><span class=w></span>

<span class=hll><span class=w>    </span><span class=c1>// To create a new Smartkey, prepare a SmartkeySpec with the information for the new key.</span><span class=w></span>
</span><span class=hll><span class=w>    </span><span class=n>SmartkeySpec</span><span class=w> </span><span class=n>createSmartkeySpec</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>SmartkeySpec</span><span class=p>();</span><span class=w></span>
</span><span class=hll><span class=w>    </span><span class=n>createSmartkeySpec</span><span class=p>.</span><span class=na>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;Sample&quot;</span><span class=p>;</span><span class=w></span>
</span><span class=hll><span class=w>    </span><span class=n>createSmartkeySpec</span><span class=p>.</span><span class=na>addAccess</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=s>&quot;john.doe@example.com&quot;</span><span class=p>);</span><span class=w></span>
</span>
<span class=w>    </span><span class=c1>// Key creation is synchronous, but you can be notified of updates to the key by listening to the Observable</span><span class=w></span>
<span class=hll><span class=w>    </span><span class=n>Observable</span><span class=o>&lt;</span><span class=n>Smartkey</span><span class=o>&gt;</span><span class=w> </span><span class=n>keyObservable</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>smartkeys</span><span class=p>.</span><span class=na>create</span><span class=p>(</span><span class=n>createSmartkeySpec</span><span class=p>);</span><span class=w></span>
</span><span class=w>    </span><span class=n>Smartkey</span><span class=w> </span><span class=n>smartkey</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>keyObservable</span><span class=w></span>
<span class=w>            </span><span class=p>.</span><span class=na>doOnEach</span><span class=p>(</span><span class=n>genericSmartkeyNotification</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>                </span><span class=n>Smartkey</span><span class=w> </span><span class=n>key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>genericSmartkeyNotification</span><span class=p>.</span><span class=na>getValue</span><span class=p>();</span><span class=w></span>
<span class=w>                </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Got revision &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>key</span><span class=p>.</span><span class=na>getRevision</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&quot; for created Smartkey &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>key</span><span class=p>.</span><span class=na>getName</span><span class=p>());</span><span class=w></span>
<span class=w>            </span><span class=p>})</span><span class=w></span>
<span class=w>            </span><span class=p>.</span><span class=na>blockingSingle</span><span class=p>();</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=nn>com.pkware.smartcrypt.keymanagement.SmartcryptKeyManagement</span><span class=w></span>
<span class=k>import</span><span class=w> </span><span class=nn>com.pkware.smartcrypt.keymanagement.SmartkeySpec</span><span class=w></span>

<span class=kd>fun</span><span class=w> </span><span class=nf>createSmartkey</span><span class=p>(</span><span class=n>keyManagement</span><span class=p>:</span><span class=w> </span><span class=n>SmartcryptKeyManagement</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=kd>val</span><span class=w> </span><span class=nv>smartkeys</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>keyManagement</span><span class=p>.</span><span class=na>smartkeys</span><span class=w></span>

<span class=hll><span class=w>    </span><span class=c1>// To create a new Smartkey, prepare a SmartkeySpec with the information for the new key.</span><span class=w></span>
</span><span class=hll><span class=w>    </span><span class=kd>val</span><span class=w> </span><span class=nv>createSmartkeySpec</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>SmartkeySpec</span><span class=p>()</span><span class=w></span>
</span><span class=hll><span class=w>    </span><span class=n>createSmartkeySpec</span><span class=p>.</span><span class=na>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;Sample&quot;</span><span class=w></span>
</span><span class=hll><span class=w>    </span><span class=n>createSmartkeySpec</span><span class=p>.</span><span class=na>addAccess</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=s>&quot;john.doe@example.com&quot;</span><span class=p>)</span><span class=w></span>
</span>
<span class=w>    </span><span class=c1>// Key creation is synchronous, but you can be notified of updates to the key by listening to the Observable</span><span class=w></span>
<span class=hll><span class=w>    </span><span class=kd>val</span><span class=w> </span><span class=nv>keyObservable</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>smartkeys</span><span class=p>.</span><span class=na>create</span><span class=p>(</span><span class=n>createSmartkeySpec</span><span class=p>)</span><span class=w></span>
</span><span class=w>    </span><span class=kd>val</span><span class=w> </span><span class=nv>smartkey</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>keyObservable</span><span class=w></span>
<span class=w>        </span><span class=p>.</span><span class=na>doOnEach</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>genericSmartkeyNotification</span><span class=w> </span><span class=o>-&gt;</span><span class=w></span>
<span class=w>            </span><span class=kd>val</span><span class=w> </span><span class=nv>key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>genericSmartkeyNotification</span><span class=p>.</span><span class=na>value</span><span class=w></span>
<span class=w>            </span><span class=n>println</span><span class=p>(</span><span class=s>&quot;Got revision </span><span class=si>${</span><span class=n>key</span><span class=o>!!</span><span class=p>.</span><span class=na>revision</span><span class=si>}</span><span class=s> for created Smartkey </span><span class=si>${</span><span class=n>key</span><span class=p>.</span><span class=na>name</span><span class=si>}</span><span class=s>&quot;</span><span class=p>)</span><span class=w></span>
<span class=w>        </span><span class=p>}</span><span class=w></span>
<span class=w>        </span><span class=p>.</span><span class=na>blockingSingle</span><span class=p>()</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div> </div> </div> </div> <h2 id=update-smartkey>Update Smartkey<a class=headerlink href=#update-smartkey title="Permanent link">&para;</a></h2> <p>To update a key, once again prepare a <code>SmartkeySpec</code>. Most types of keys can be updated in some fashion.</p> <div class="tabbed-set tabbed-alternate" data-tabs=7:2><input checked=checked id=__tabbed_7_1 name=__tabbed_7 type=radio><input id=__tabbed_7_2 name=__tabbed_7 type=radio><div class=tabbed-labels><label for=__tabbed_7_1>Java</label><label for=__tabbed_7_2>Kotlin</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=kn>import</span><span class=w> </span><span class=nn>com.pkware.smartcrypt.keymanagement.SmartcryptKeyManagement</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>com.pkware.smartcrypt.keymanagement.SmartkeySpec</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>com.pkware.smartcrypt.keymanagement.Smartkeys</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>com.pkware.smartcrypt.keymanagement.smartkeys.Smartkey</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>io.reactivex.Observable</span><span class=p>;</span><span class=w></span>

<span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>updateSmartkey</span><span class=p>(</span><span class=n>SmartcryptKeyManagement</span><span class=w> </span><span class=n>keyManagement</span><span class=p>,</span><span class=w> </span><span class=n>Smartkey</span><span class=w> </span><span class=n>smartkey</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>Smartkeys</span><span class=w> </span><span class=n>smartkeys</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>keyManagement</span><span class=p>.</span><span class=na>getSmartkeys</span><span class=p>();</span><span class=w></span>

<span class=hll><span class=w>    </span><span class=n>SmartkeySpec</span><span class=w> </span><span class=n>updateSmartkeySpec</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>SmartkeySpec</span><span class=p>();</span><span class=w></span>
</span><span class=hll><span class=w>    </span><span class=n>updateSmartkeySpec</span><span class=p>.</span><span class=na>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;Updated Sample&quot;</span><span class=p>;</span><span class=w></span>
</span><span class=hll><span class=w>    </span><span class=n>updateSmartkeySpec</span><span class=p>.</span><span class=na>removeAccess</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=s>&quot;john.doe@example.com&quot;</span><span class=p>);</span><span class=w></span>
</span>
<span class=w>    </span><span class=c1>// Key updates are synchronous, but you can be notified of updates to the key by listening to the Observable</span><span class=w></span>
<span class=hll><span class=w>    </span><span class=n>Observable</span><span class=o>&lt;</span><span class=n>Smartkey</span><span class=o>&gt;</span><span class=w> </span><span class=n>updatedKeyObservable</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>smartkeys</span><span class=p>.</span><span class=na>update</span><span class=p>(</span><span class=n>smartkey</span><span class=p>,</span><span class=w> </span><span class=n>updateSmartkeySpec</span><span class=p>);</span><span class=w></span>
</span><span class=w>    </span><span class=n>updatedKeyObservable</span><span class=p>.</span><span class=na>subscribe</span><span class=p>(</span><span class=n>key</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Got updated Smartkey &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>key</span><span class=p>.</span><span class=na>getName</span><span class=p>()));</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=nn>com.pkware.smartcrypt.keymanagement.SmartcryptKeyManagement</span><span class=w></span>
<span class=k>import</span><span class=w> </span><span class=nn>com.pkware.smartcrypt.keymanagement.SmartkeySpec</span><span class=w></span>
<span class=k>import</span><span class=w> </span><span class=nn>com.pkware.smartcrypt.keymanagement.smartkeys.Smartkey</span><span class=w></span>

<span class=kd>fun</span><span class=w> </span><span class=nf>updateSmartkey</span><span class=p>(</span><span class=n>keyManagement</span><span class=p>:</span><span class=w> </span><span class=n>SmartcryptKeyManagement</span><span class=p>,</span><span class=w> </span><span class=n>smartkey</span><span class=p>:</span><span class=w> </span><span class=n>Smartkey</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=kd>val</span><span class=w> </span><span class=nv>smartkeys</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>keyManagement</span><span class=p>.</span><span class=na>smartkeys</span><span class=w></span>

<span class=hll><span class=w>    </span><span class=kd>val</span><span class=w> </span><span class=nv>updateSmartkeySpec</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>SmartkeySpec</span><span class=p>()</span><span class=w></span>
</span><span class=hll><span class=w>    </span><span class=n>updateSmartkeySpec</span><span class=p>.</span><span class=na>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;Updated Sample&quot;</span><span class=w></span>
</span><span class=hll><span class=w>    </span><span class=n>updateSmartkeySpec</span><span class=p>.</span><span class=na>removeAccess</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=s>&quot;john.doe@example.com&quot;</span><span class=p>)</span><span class=w></span>
</span>
<span class=w>    </span><span class=c1>// Key updates are synchronous, but you can be notified of updates to the key by listening to the Observable</span><span class=w></span>
<span class=hll><span class=w>    </span><span class=kd>val</span><span class=w> </span><span class=nv>updatedKeyObservable</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>smartkeys</span><span class=p>.</span><span class=na>update</span><span class=p>(</span><span class=n>smartkey</span><span class=p>,</span><span class=w> </span><span class=n>updateSmartkeySpec</span><span class=p>)</span><span class=w></span>
</span><span class=w>    </span><span class=n>updatedKeyObservable</span><span class=p>.</span><span class=na>subscribe</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>key</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>println</span><span class=p>(</span><span class=s>&quot;Got updated Smartkey </span><span class=si>${</span><span class=n>key</span><span class=p>.</span><span class=na>name</span><span class=si>}</span><span class=s>&quot;</span><span class=p>)</span><span class=w> </span><span class=p>}</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div> </div> </div> </div> <h2 id=working-offline>Working offline<a class=headerlink href=#working-offline title="Permanent link">&para;</a></h2> <p>By default, the SDK stores key and account information in-memory. In this configuration, the application will be able to use Smartkeys offline only until the process dies. Then, if the device is offline when the application again starts up, it will not have access to Smartkeys and account data. Often it is desireable for an application to continue working under these conditions. In that case, it is essential that account data get saved for offline use.</p> <p>The mechanism in the SDK to provide hooks for saving data is called the <a href=../api/?com/pkware/smartcrypt/keymanagement/PersistenceCallback.html><code>PersistenceCallback</code></a>. The <a href=../api/?com/pkware/smartcrypt/keymanagement/PersistenceCallback.html><code>PersistenceCallback</code></a> is invoked by the SDK with the data modifications that need to be made. You must implement a <a href=../api/?com/pkware/smartcrypt/keymanagement/PersistenceCallback.html><code>PersistenceCallback</code></a> of your own - the SDK does not come with an implementation.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Be sure to review the <a href=../api/?com/pkware/smartcrypt/keymanagement/PersistenceCallback.html><code>PersistenceCallback</code></a> documentation when implementing your own class.</p> </div> <div class="tabbed-set tabbed-alternate" data-tabs=8:2><input checked=checked id=__tabbed_8_1 name=__tabbed_8 type=radio><input id=__tabbed_8_2 name=__tabbed_8 type=radio><div class=tabbed-labels><label for=__tabbed_8_1>Java</label><label for=__tabbed_8_2>Kotlin</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=kn>import</span><span class=w> </span><span class=nn>com.pkware.smartcrypt.keymanagement.PersistenceCallback</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>com.pkware.smartcrypt.keymanagement.SmartcryptKeyManagementImpl</span><span class=p>;</span><span class=w></span>

<span class=kn>import</span><span class=w> </span><span class=nn>java.io.BufferedWriter</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>java.io.IOException</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>java.nio.file.Files</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>java.nio.file.Paths</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>java.util.Collections</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>java.util.Map</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>java.util.Set</span><span class=p>;</span><span class=w></span>

<span class=kn>import static</span><span class=w> </span><span class=nn>java.util.stream.Collectors.toMap</span><span class=p>;</span><span class=w></span>

<span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>SmartcryptKeyManagementImpl</span><span class=p>.</span><span class=na>Builder</span><span class=w> </span><span class=nf>configureDataPersistence</span><span class=p>(</span><span class=n>SmartcryptKeyManagementImpl</span><span class=p>.</span><span class=na>Builder</span><span class=w> </span><span class=n>builder</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>

<span class=hll><span class=w>    </span><span class=c1>// It is up to you how you store your data. In files, in a database, on the network, etc.</span><span class=w></span>
</span><span class=hll><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>builder</span><span class=p>.</span><span class=na>persistenceCallback</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>FilePersistenceCallback</span><span class=p>());</span><span class=w></span>
</span><span class=p>}</span><span class=w></span>

<span class=hll><span class=c1>// Note: This class is not part of the SDK</span><span class=w></span>
</span><span class=hll><span class=kd>class</span> <span class=nc>FilePersistenceCallback</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>PersistenceCallback</span><span class=w> </span><span class=p>{</span><span class=w></span>
</span><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>folder</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;serializedSmartcryptData&quot;</span><span class=p>;</span><span class=w></span>

<span class=w>    </span><span class=nd>@Override</span><span class=w></span>
<span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>onSaveData</span><span class=p>(</span><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>toSave</span><span class=p>,</span><span class=w> </span><span class=n>Set</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>toDelete</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>            </span><span class=n>Files</span><span class=p>.</span><span class=na>createDirectory</span><span class=p>(</span><span class=n>Paths</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>folder</span><span class=p>));</span><span class=w></span>
<span class=w>            </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>Map</span><span class=p>.</span><span class=na>Entry</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>datum</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>toSave</span><span class=p>.</span><span class=na>entrySet</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>                </span><span class=k>try</span><span class=w> </span><span class=p>(</span><span class=n>BufferedWriter</span><span class=w> </span><span class=n>writer</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Files</span><span class=p>.</span><span class=na>newBufferedWriter</span><span class=p>(</span><span class=n>Paths</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>folder</span><span class=p>,</span><span class=w> </span><span class=n>datum</span><span class=p>.</span><span class=na>getKey</span><span class=p>())))</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>                    </span><span class=n>writer</span><span class=p>.</span><span class=na>write</span><span class=p>(</span><span class=n>datum</span><span class=p>.</span><span class=na>getValue</span><span class=p>());</span><span class=w></span>
<span class=w>                </span><span class=p>}</span><span class=w></span>
<span class=w>            </span><span class=p>}</span><span class=w></span>

<span class=w>            </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>toDelete</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>                </span><span class=n>Files</span><span class=p>.</span><span class=na>deleteIfExists</span><span class=p>(</span><span class=n>Paths</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>folder</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>));</span><span class=w></span>
<span class=w>            </span><span class=p>}</span><span class=w></span>
<span class=w>            </span><span class=k>return</span><span class=w> </span><span class=kc>true</span><span class=p>;</span><span class=w></span>
<span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>IOException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>            </span><span class=k>return</span><span class=w> </span><span class=kc>false</span><span class=p>;</span><span class=w></span>
<span class=w>        </span><span class=p>}</span><span class=w></span>
<span class=w>    </span><span class=p>}</span><span class=w></span>

<span class=w>    </span><span class=nd>@Override</span><span class=w></span>
<span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=nf>onLoadData</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>(</span><span class=n>Stream</span><span class=o>&lt;</span><span class=n>Path</span><span class=o>&gt;</span><span class=w> </span><span class=n>stream</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Files</span><span class=p>.</span><span class=na>list</span><span class=p>(</span><span class=n>Paths</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>folder</span><span class=p>)))</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>stream</span><span class=p>.</span><span class=na>collect</span><span class=p>(</span><span class=n>toMap</span><span class=p>(</span><span class=w></span>
<span class=w>                    </span><span class=n>path</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>path</span><span class=p>.</span><span class=na>getFileName</span><span class=p>().</span><span class=na>toString</span><span class=p>(),</span><span class=w>                      </span><span class=c1>// Key</span><span class=w></span>
<span class=w>                    </span><span class=n>fileName</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>                                               </span><span class=c1>// Value</span><span class=w></span>
<span class=w>                        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>                            </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>String</span><span class=p>(</span><span class=n>Files</span><span class=p>.</span><span class=na>readAllBytes</span><span class=p>(</span><span class=n>fileName</span><span class=p>));</span><span class=w></span>
<span class=w>                        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>IOException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>                            </span><span class=n>e</span><span class=p>.</span><span class=na>printStackTrace</span><span class=p>();</span><span class=w></span>
<span class=w>                            </span><span class=k>return</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=p>;</span><span class=w></span>
<span class=w>                        </span><span class=p>}</span><span class=w></span>
<span class=w>                    </span><span class=p>}</span><span class=w></span>
<span class=w>            </span><span class=p>));</span><span class=w></span>
<span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>IOException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>Collections</span><span class=p>.</span><span class=na>emptyMap</span><span class=p>();</span><span class=w></span>
<span class=w>        </span><span class=p>}</span><span class=w></span>
<span class=w>    </span><span class=p>}</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=kn>import</span><span class=w> </span><span class=nn>com.pkware.smartcrypt.keymanagement.PersistenceCallback</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>com.pkware.smartcrypt.keymanagement.SmartcryptKeyManagementImpl</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>java.io.IOException</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>java.nio.file.Files</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>java.nio.file.Paths</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>java.util.stream.Collectors.toMap</span><span class=w></span>

<span class=n>fun</span><span class=w> </span><span class=nf>configureDataPersistence</span><span class=p>(</span><span class=n>builder</span><span class=p>:</span><span class=w> </span><span class=n>SmartcryptKeyManagementImpl</span><span class=p>.</span><span class=na>Builder</span><span class=p>):</span><span class=w> </span><span class=n>SmartcryptKeyManagementImpl</span><span class=p>.</span><span class=na>Builder</span><span class=w> </span><span class=p>{</span><span class=w></span>

<span class=hll><span class=w>    </span><span class=c1>// It is up to you how you store your data. In files, in a database, on the network, etc.</span><span class=w></span>
</span><span class=hll><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>builder</span><span class=p>.</span><span class=na>persistenceCallback</span><span class=p>(</span><span class=n>FilePersistenceCallback</span><span class=p>())</span><span class=w></span>
</span><span class=p>}</span><span class=w></span>

<span class=hll><span class=c1>// Note: This class is not part of the SDK</span><span class=w></span>
</span><span class=hll><span class=kd>class</span> <span class=nc>FilePersistenceCallback</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>PersistenceCallback</span><span class=w> </span><span class=p>{</span><span class=w></span>
</span><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>val</span><span class=w> </span><span class=n>folder</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;serializedSmartcryptData&quot;</span><span class=w></span>

<span class=w>    </span><span class=n>override</span><span class=w> </span><span class=n>fun</span><span class=w> </span><span class=nf>onSaveData</span><span class=p>(</span><span class=n>toSave</span><span class=p>:</span><span class=w> </span><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=o>&gt;</span><span class=p>,</span><span class=w> </span><span class=n>toDelete</span><span class=p>:</span><span class=w> </span><span class=n>Set</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=p>):</span><span class=w> </span><span class=n>Boolean</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>        </span><span class=n>Files</span><span class=p>.</span><span class=na>createDirectory</span><span class=p>(</span><span class=n>Paths</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>folder</span><span class=p>))</span><span class=w></span>
<span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>((</span><span class=n>key</span><span class=p>,</span><span class=w> </span><span class=n>value</span><span class=p>)</span><span class=w> </span><span class=n>in</span><span class=w> </span><span class=n>toSave</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>            </span><span class=n>Files</span><span class=p>.</span><span class=na>newBufferedWriter</span><span class=p>(</span><span class=n>Paths</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>folder</span><span class=p>,</span><span class=w> </span><span class=n>key</span><span class=p>)).</span><span class=na>use</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>writer</span><span class=w> </span><span class=o>-&gt;</span><span class=w></span>
<span class=w>                </span><span class=n>writer</span><span class=p>.</span><span class=na>write</span><span class=p>(</span><span class=n>value</span><span class=p>)</span><span class=w></span>
<span class=w>            </span><span class=p>}</span><span class=w></span>
<span class=w>        </span><span class=p>}</span><span class=w></span>
<span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=n>in</span><span class=w> </span><span class=n>toDelete</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>            </span><span class=n>Files</span><span class=p>.</span><span class=na>deleteIfExists</span><span class=p>(</span><span class=n>Paths</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>folder</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>))</span><span class=w></span>
<span class=w>        </span><span class=p>}</span><span class=w></span>
<span class=w>        </span><span class=kc>true</span><span class=w></span>
<span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>e</span><span class=p>:</span><span class=w> </span><span class=n>IOException</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>        </span><span class=kc>false</span><span class=w></span>
<span class=w>    </span><span class=p>}</span><span class=w></span>

<span class=w>    </span><span class=n>override</span><span class=w> </span><span class=n>fun</span><span class=w> </span><span class=nf>onLoadData</span><span class=p>():</span><span class=w> </span><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>        </span><span class=n>Files</span><span class=p>.</span><span class=na>list</span><span class=p>(</span><span class=n>Paths</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>folder</span><span class=p>)).</span><span class=na>use</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>stream</span><span class=w> </span><span class=o>-&gt;</span><span class=w></span>
<span class=w>            </span><span class=n>stream</span><span class=p>.</span><span class=na>collect</span><span class=p>(</span><span class=n>toMap</span><span class=p>(</span><span class=w></span>
<span class=w>                </span><span class=p>{</span><span class=w> </span><span class=n>path</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>path</span><span class=p>.</span><span class=na>fileName</span><span class=p>.</span><span class=na>toString</span><span class=p>()</span><span class=w> </span><span class=p>},</span><span class=w>             </span><span class=c1>// Key</span><span class=w></span>
<span class=w>                </span><span class=p>{</span><span class=w> </span><span class=n>fileName</span><span class=w> </span><span class=o>-&gt;</span><span class=w>                                     </span><span class=c1>// Value</span><span class=w></span>
<span class=w>                    </span><span class=k>return</span><span class=nd>@toMap</span><span class=w> </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>                        </span><span class=n>String</span><span class=p>(</span><span class=n>Files</span><span class=p>.</span><span class=na>readAllBytes</span><span class=p>(</span><span class=n>fileName</span><span class=p>))</span><span class=w></span>
<span class=w>                    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>e</span><span class=p>:</span><span class=w> </span><span class=n>IOException</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>                        </span><span class=n>e</span><span class=p>.</span><span class=na>printStackTrace</span><span class=p>()</span><span class=w></span>
<span class=w>                        </span><span class=s>&quot;&quot;</span><span class=w></span>
<span class=w>                    </span><span class=p>}</span><span class=w></span>
<span class=w>                </span><span class=p>}</span><span class=w></span>
<span class=w>            </span><span class=p>))</span><span class=w></span>
<span class=w>        </span><span class=p>}</span><span class=w></span>
<span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>e</span><span class=p>:</span><span class=w> </span><span class=n>IOException</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>        </span><span class=n>emptyMap</span><span class=p>()</span><span class=w></span>
<span class=w>    </span><span class=p>}</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div> </div> </div> </div> <p>Once your <code>PersistenceCallback</code> is configured, you must modify your application to restore data into the SDK when it starts up.</p> <div class="tabbed-set tabbed-alternate" data-tabs=9:2><input checked=checked id=__tabbed_9_1 name=__tabbed_9 type=radio><input id=__tabbed_9_2 name=__tabbed_9 type=radio><div class=tabbed-labels><label for=__tabbed_9_1>Java</label><label for=__tabbed_9_2>Kotlin</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=kn>import</span><span class=w> </span><span class=nn>com.pkware.smartcrypt.keymanagement.DataStorage</span><span class=p>;</span><span class=w></span>
<span class=kn>import</span><span class=w> </span><span class=nn>com.pkware.smartcrypt.keymanagement.SmartcryptKeyManagement</span><span class=p>;</span><span class=w></span>

<span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>restoreSmartcryptData</span><span class=p>(</span><span class=n>SmartcryptKeyManagement</span><span class=w> </span><span class=n>keyManagement</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=n>DataStorage</span><span class=w> </span><span class=n>dataStorage</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>keyManagement</span><span class=p>.</span><span class=na>getDataStorage</span><span class=p>();</span><span class=w></span>

<span class=hll><span class=w>    </span><span class=c1>// This causes the SDK to call your PersistenceCallback to load data</span><span class=w></span>
</span><span class=hll><span class=w>    </span><span class=c1>// You control both the threading and timing of how data are restored</span><span class=w></span>
</span><span class=hll><span class=w>    </span><span class=n>dataStorage</span><span class=p>.</span><span class=na>restore</span><span class=p>();</span><span class=w></span>
</span><span class=p>}</span><span class=w></span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=nn>com.pkware.smartcrypt.keymanagement.SmartcryptKeyManagement</span><span class=w></span>

<span class=kd>fun</span><span class=w> </span><span class=nf>restoreSmartcryptData</span><span class=p>(</span><span class=n>keyManagement</span><span class=p>:</span><span class=w> </span><span class=n>SmartcryptKeyManagement</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=kd>val</span><span class=w> </span><span class=nv>dataStorage</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>keyManagement</span><span class=p>.</span><span class=na>getDataStorage</span><span class=p>();</span><span class=w></span>

<span class=hll><span class=w>    </span><span class=c1>// This causes the SDK to call your PersistenceCallback to load data.</span><span class=w></span>
</span><span class=hll><span class=w>    </span><span class=c1>// You control both the threading and timing of how data are restored</span><span class=w></span>
</span><span class=hll><span class=w>    </span><span class=n>dataStorage</span><span class=p>.</span><span class=na>restore</span><span class=p>();</span><span class=w></span>
</span><span class=p>}</span><span class=w></span>
</code></pre></div> </div> </div> </div> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../fileEncryption/zipDetails/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Zip file details" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Zip file details </div> </div> </a> <a href=installing/ class="md-footer__link md-footer__link--next" aria-label="Next: Installing" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Installing </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2020 PKWARE, Inc. </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["navigation.tabs"], "search": "../assets/javascripts/workers/search.5bf1dace.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../assets/javascripts/bundle.078830c0.min.js></script> </body> </html>